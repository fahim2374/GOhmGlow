<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GŒ©GLOW</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    * { margin:0; padding:0; box-sizing:border-box; font-family:"Poppins",sans-serif; }
    
    body {
      min-height:100vh; display:flex; justify-content:center; align-items:center;
      background:url('./222.jpg') no-repeat center center/cover;
      position:relative;
      padding:20px;
    }
    
    body::before {
      content:""; position:absolute; top:0; left:0; width:100%; height:100%;
      background: rgba(0,0,0,0.5); z-index:0;
    }

    .app-container {
      position: relative; z-index:1;
      width:100%; max-width:720px; padding:25px;
      background: rgba(255,255,255,0.15); border-radius:20px; backdrop-filter:blur(12px);
      box-shadow:0 8px 32px rgba(0,0,0,0.2);
      display:flex; flex-direction:column; align-items:center;
      animation:fadeIn 1.5s ease;
    }

    @keyframes fadeIn { from{opacity:0; transform:translateY(30px);} to{opacity:1; transform:translateY(0);} }

    h1 { color:#fff; font-size:2em; text-align:center; margin-bottom:15px; }
    #weatherIcon { font-size:3em; margin-top:10px; }
    h2 { color:#08fc00; font-size:1.2em; text-align:center; margin-top:10px; }

    input, button {
      width:80%; max-width:400px; padding:12px; margin:5px; border-radius:8px; border:none; font-size:1em;
    }
    button { background:#2575fc; color:#fff; cursor:pointer; transition:0.3s; }
    button:hover { background:#6a11cb; }

    #map { width:100%; height:250px; border-radius:15px; margin-top:15px; }
    #chartContainer { width:100%; margin-top:20px; background:rgba(255,255,255,0.1); padding:15px; border-radius:12px; }

    /* Responsive */
    @media (max-width:600px){
      h1 { font-size:1.5em; }
      #weatherIcon { font-size:2.5em; }
      h2 { font-size:1em; }
      input, button { width:90%; font-size:0.9em; }
      #map { height:200px; }
      #chartContainer { padding:10px; }
    }

    @media (max-width:400px){
      h1 { font-size:1.3em; }
      #weatherIcon { font-size:2em; }
      h2 { font-size:0.9em; }
      input, button { width:95%; font-size:0.85em; }
      #map { height:180px; }
    }
  </style>
</head>
<body>

  <div class="app-container">
    <h1>G<span style="color: aqua;">Œ©</span>GLOW</h1>
    <h3 style="color: aliceblue;">‚òÅÔ∏è Will It Rain On My Parade?</h3>
    <input type="text" id="locationInput" placeholder="Enter city name" />
    <button id="checkWeatherBtn">Check Weather</button>
    <div id="weatherIcon"></div>
    <h2 id="result">Enter a location to see the chance of rain.</h2>

    <div id="map"></div>

    <div id="chartContainer">
      <canvas id="trendChart"></canvas>
    </div>
  </div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <script>
    let map, marker, chart;
    const checkBtn = document.getElementById("checkWeatherBtn");
    checkBtn.addEventListener("click", fetchWeather);

    async function fetchWeather() {
      const location = document.getElementById("locationInput").value.trim();
      const resultEl = document.getElementById("result");
      const iconEl = document.getElementById("weatherIcon");

      if(!location){
        resultEl.innerText = "‚ö†Ô∏è Please enter a location.";
        iconEl.innerText = "‚ùå";
        return;
      }

      resultEl.innerText = "Fetching weather data...";
      iconEl.innerText = "‚åõ";

      try {
        // Geocoding
        const geoRes = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${location}`);
        const geoData = await geoRes.json();

        if(!geoData.results || geoData.results.length === 0){
          resultEl.innerText = "‚ö†Ô∏è Location not found.";
          iconEl.innerText = "‚ùå";
          return;
        }

        const { latitude, longitude, name, country } = geoData.results[0];

        // Map
        if(!map){
          map = L.map('map').setView([latitude, longitude], 10);
          L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution:'&copy; OpenStreetMap contributors'
          }).addTo(map);
          marker = L.marker([latitude, longitude]).addTo(map);
        } else {
          map.setView([latitude, longitude], 10);
          marker.setLatLng([latitude, longitude]);
        }

        // Today's rain probability
        const weatherRes = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&daily=precipitation_probability_max&timezone=auto`);
        const weatherData = await weatherRes.json();
        const chance = weatherData.daily.precipitation_probability_max[0];

        resultEl.innerHTML = `üåßÔ∏è Chance of rain today in <b>${name}, ${country}</b>: <b>${chance}%</b>`;
        iconEl.innerText = chance>60 ? "üåßÔ∏è" : chance>20 ? "‚õÖ" : "‚òÄÔ∏è";

        // Past 7-day trend (placeholder)
        const pastDates = [];
        const pastValues = [];
        for(let i=6;i>=0;i--){
          const d = new Date();
          d.setDate(d.getDate() - i);
          pastDates.push(d.toISOString().split("T")[0]);
          pastValues.push(Math.floor(Math.random()*80)); // Placeholder
        }

        if(chart) chart.destroy();
        const ctx = document.getElementById("trendChart").getContext("2d");
        chart = new Chart(ctx,{
          type:'line',
          data:{
            labels:pastDates,
            datasets:[{
              label:'Rain Probability (%)',
              data:pastValues,
              borderColor:'yellow',
              backgroundColor:'rgba(255,255,0,0.2)',
              fill:true,
              tension:0.4
            }]
          },
          options:{
            responsive:true,
            scales:{ y:{beginAtZero:true, max:100} }
          }
        });

      } catch(err){
        console.error(err);
        resultEl.innerText = "‚ö†Ô∏è Unable to fetch weather data.";
        iconEl.innerText = "";
      }
    }
  </script>
</body>
</html>
